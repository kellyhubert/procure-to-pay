# Render Deployment Guide

## Files Created/Modified for Render Deployment

### 1. render.yaml
Main Blueprint configuration file that defines all services:
- **PostgreSQL Database**: Free tier PostgreSQL instance
- **Backend Service**: Django API with Docker
- **Frontend Service**: Static React site built with Vite

### 2. backend/Dockerfile.render
Production-optimized Dockerfile that:
- Installs all dependencies including tesseract for OCR
- Collects static files
- Runs migrations on startup
- Creates default superuser (admin/admin123)
- Starts gunicorn server

### 3. backend/requirements.txt
Added production dependencies:
- gunicorn==21.2.0 (WSGI server)
- whitenoise==6.6.0 (static file serving)
- dj-database-url==2.1.0 (database URL parsing)

### 4. backend/config/settings.py
Updated for production:
- SECRET_KEY from environment variable
- DEBUG from environment variable
- ALLOWED_HOSTS from environment variable
- DATABASE_URL support with dj_database_url
- WhiteNoise middleware for static files
- Production CORS settings
- WhiteNoise storage backend

### 5. backend/.env.example
Added DATABASE_URL example for production

## Deployment Steps

1. **Push to GitHub**
   ```bash
   git add .
   git commit -m "Add Render deployment configuration"
   git push origin main
   ```

2. **Create Blueprint on Render**
   - Go to https://dashboard.render.com/
   - Click "New +" â†’ "Blueprint"
   - Connect your GitHub repository
   - Select this repository
   - Render will detect render.yaml

3. **Set Environment Variable**
   - Set OPENAI_API_KEY during Blueprint setup (optional)
   - All other variables are auto-generated

4. **Deploy**
   - Click "Apply"
   - Wait 5-10 minutes for initial deployment

5. **Access Application**
   - Frontend: https://procure-to-pay-frontend.onrender.com
   - Backend: https://procure-to-pay-backend.onrender.com/api/
   - Admin: https://procure-to-pay-backend.onrender.com/admin/
   - Swagger: https://procure-to-pay-backend.onrender.com/swagger/

## Environment Variables

### Automatically Generated by Render:
- DATABASE_URL (from PostgreSQL service)
- SECRET_KEY (generated)
- PORT (assigned by Render)

### Set by render.yaml:
- DEBUG=False
- ALLOWED_HOSTS=.onrender.com

### Manual Configuration Required:
- OPENAI_API_KEY (for AI document processing)

## Service Configuration

### Database
- Type: PostgreSQL
- Plan: Free (256MB storage)
- Database Name: procure_to_pay
- User: procure_user

### Backend
- Type: Web Service (Docker)
- Plan: Free
- Region: Oregon
- Build: Docker build with Dockerfile.render
- Start: gunicorn with 2 workers
- Health Check: /api/

### Frontend
- Type: Static Site
- Plan: Free
- Region: Oregon
- Build: npm install && npm run build
- Root: frontend/
- Publish: dist/
- SPA Routing: All routes rewrite to /index.html

## Important Notes

1. **Free Tier Spin Down**: Services sleep after 15 minutes of inactivity. First request takes 30-60 seconds to wake up.

2. **Database Storage**: Free tier has 256MB limit. Monitor usage in Render dashboard.

3. **Automatic Deployments**: Render automatically redeploys on git push to main branch.

4. **Logs**: View real-time logs in Render dashboard for debugging.

5. **Superuser**: Default admin user (admin/admin123) is created automatically on first deployment.

6. **Static Files**: Served by WhiteNoise, collected during Docker build.

7. **Media Files**: Uploaded files (proforma, receipts) are stored in container filesystem. Note: These are ephemeral on free tier.

## Troubleshooting

### Backend Won't Start
- Check Render logs for errors
- Verify DATABASE_URL is connected
- Ensure all requirements.txt dependencies install

### Frontend Shows 404
- Check build logs for npm errors
- Verify VITE_API_URL is set correctly
- Ensure staticPublishPath points to dist/

### Database Connection Fails
- Check database service is running
- Verify DATABASE_URL environment variable
- Check database logs in Render dashboard

### CORS Errors
- Verify backend ALLOWED_HOSTS includes .onrender.com
- Check CORS_ALLOWED_ORIGINS in production settings
- Ensure frontend URL matches CORS config

## Cost Estimate

All services use Render's free tier:
- PostgreSQL: $0/month (256MB)
- Backend: $0/month (750 hours free)
- Frontend: $0/month (100GB bandwidth)

**Total: $0/month**

Note: Free tier services have limitations. For production use, consider upgrading to paid plans for better performance and reliability.
